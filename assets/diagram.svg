<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 540 440" width="540" height="440" font-family="'Courier New', Consolas, monospace">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#2d8a4e"/>
    </marker>
    <marker id="arrowGold" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#c9a83e"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect x="0" y="0" width="540" height="440" fill="#f7f7f5"/>

  <!-- Node 1: iGPT client -->
  <rect x="110" y="25" width="220" height="46" rx="4" fill="#d4edda" stroke="#2d8a4e" stroke-width="1.2"/>
  <text x="220" y="53" text-anchor="middle" fill="#1a5c2e" font-size="13" font-weight="600">IGPT(api_key, user)</text>

  <!-- Arrow down to check -->
  <line x1="220" y1="71" x2="220" y2="110" stroke="#2d8a4e" stroke-width="1.2" stroke-dasharray="6,4" marker-end="url(#arrow)"/>

  <!-- Node 2: check_datasources -->
  <rect x="100" y="115" width="240" height="46" rx="4" fill="#d4edda" stroke="#2d8a4e" stroke-width="1.2"/>
  <text x="220" y="143" text-anchor="middle" fill="#1a5c2e" font-size="13" font-weight="600">check_datasources</text>

  <!-- Arrow right: no → authorize -->
  <path d="M 340 138 L 400 138" stroke="#c9a83e" stroke-width="1.2" stroke-dasharray="6,4" marker-end="url(#arrowGold)"/>
  <text x="370" y="130" text-anchor="middle" fill="#c9a83e" font-size="10" font-weight="600">no</text>

  <!-- Node: authorize (dead end) -->
  <rect x="405" y="115" width="120" height="46" rx="4" fill="#fef9e7" stroke="#c9a83e" stroke-width="1.2"/>
  <text x="465" y="143" text-anchor="middle" fill="#8a7020" font-size="13" font-weight="600">authorize</text>

  <!-- Stop label under authorize -->
  <text x="465" y="180" text-anchor="middle" fill="#aaa" font-size="10" font-style="italic">re-run after auth</text>

  <!-- Arrow down: yes → recall.ask -->
  <line x1="220" y1="161" x2="220" y2="240" stroke="#2d8a4e" stroke-width="1.2" stroke-dasharray="6,4" marker-end="url(#arrow)"/>
  <text x="235" y="195" fill="#2d8a4e" font-size="10" font-weight="600">yes</text>

  <!-- Node 3: recall.ask -->
  <rect x="90" y="245" width="260" height="50" rx="4" fill="#d4edda" stroke="#2d8a4e" stroke-width="1.6"/>
  <text x="220" y="275" text-anchor="middle" fill="#1a5c2e" font-size="14" font-weight="700">recall.ask()</text>

  <!-- Arrow down to output -->
  <line x1="220" y1="295" x2="220" y2="345" stroke="#2d8a4e" stroke-width="1.2" stroke-dasharray="6,4" marker-end="url(#arrow)"/>

  <!-- Node 4: structured output -->
  <rect x="60" y="350" width="320" height="46" rx="4" fill="#d4edda" stroke="#2d8a4e" stroke-width="1.2"/>
  <text x="220" y="378" text-anchor="middle" fill="#1a5c2e" font-size="13" font-weight="600">structured_json_output</text>
</svg>
